# ğŸ“Š é…å¸ƒé»æ•¸è¨ˆç®—ç³»çµ±ï¼ˆDistribution Points Systemï¼‰

> **æ–‡ä»¶ç‰ˆæœ¬**ï¼šv1.0  
> **æœ€å¾Œæ›´æ–°**ï¼š2026-02-13  
> **å°æ‡‰å…ƒä»¶**ï¼š`components/PokedexContent.tsx`  
> **è³‡æ–™åº«è¡¨**ï¼š`distributions.points` (INTEGER)

---

## ğŸ“‹ ç›®éŒ„

1. [ç³»çµ±æ¦‚è¿°](#ç³»çµ±æ¦‚è¿°)
2. [ä¸–ä»£åŸºç¤é»æ•¸ç¯„åœ](#ä¸–ä»£åŸºç¤é»æ•¸ç¯„åœ)
3. [è³‡æ–™åº«å±¤è¨ˆç®—å…¬å¼](#è³‡æ–™åº«å±¤è¨ˆç®—å…¬å¼)
4. [å‰ç«¯é¡¯ç¤ºé‚è¼¯](#å‰ç«¯é¡¯ç¤ºé‚è¼¯)
5. [æ¼²è·Œå¹…æ¼”ç®—æ³•](#æ¼²è·Œå¹…æ¼”ç®—æ³•)
6. [é»æ•¸æ ¼å¼åŒ–](#é»æ•¸æ ¼å¼åŒ–)
7. [è¦–è¦ºè‰²éšç³»çµ±](#è¦–è¦ºè‰²éšç³»çµ±)
8. [ç‰¹æ®Šè¦å‰‡](#ç‰¹æ®Šè¦å‰‡)
9. [å…è²¬è²æ˜å½ˆçª—](#å…è²¬è²æ˜å½ˆçª—)
10. [è³‡æ–™çµ±è¨ˆ](#è³‡æ–™çµ±è¨ˆ)

---

## ç³»çµ±æ¦‚è¿°

é…å¸ƒé»æ•¸ç³»çµ±ç‚ºæ¯ä¸€ç­†å¯¶å¯å¤¢é…å¸ƒç´€éŒ„è³¦äºˆä¸€å€‹ã€Œåƒ¹å€¼åˆ†æ•¸ã€ï¼Œæ¨¡æ“¬é¡ä¼¼è‚¡ç¥¨å¸‚å ´çš„è¡Œæƒ…é¡¯ç¤ºã€‚è¨­è¨ˆç›®æ¨™ï¼š

- **åæ˜ ç¨€æœ‰åº¦**ï¼šè¶Šå¤è€çš„ä¸–ä»£ã€è¶Šç¨€æœ‰çš„é…å¸ƒæ–¹å¼ï¼Œé»æ•¸è¶Šé«˜
- **æ¯ç­†ç¨ç‰¹**ï¼šé€é UUID-based éš¨æ©Ÿåç§»ï¼Œç¢ºä¿åŒä¸–ä»£å…§æ¯å¼µå¡çš„é»æ•¸ä¸é‡è¤‡
- **å‹•æ…‹æ„Ÿ**ï¼šæ¯æ—¥è®ŠåŒ–çš„æ¼²è·Œå¹…ï¼Œç‡Ÿé€ ã€Œæ´»çš„å¸‚å ´ã€æ°›åœ
- **è¦–è¦ºå±¤æ¬¡**ï¼šæ ¹æ“šé»æ•¸é«˜ä½ï¼Œä½¿ç”¨ä¸åŒçš„æ¼¸å±¤è‰²æ¨™ç±¤ï¼Œä¸€çœ¼å€åˆ†ç¨€æœ‰åº¦

---

## ä¸–ä»£åŸºç¤é»æ•¸ç¯„åœ

| ä¸–ä»£ | æœ€ä½é»æ•¸ | æœ€é«˜é»æ•¸ | è¨­è¨ˆç†å¿µ |
|:----:|--------:|--------:|---------|
| 3    | 650,000 | 1,200,000 | æœ€å¤è€çš„é…å¸ƒï¼Œæ¥µåº¦ç¨€æœ‰ï¼Œè·ä»Šç´„ 20 å¹´ |
| 4    | 220,000 | 350,000 | ç¬¬å››ä¸–ä»£ DS æ™‚æœŸï¼Œç¨€æœ‰åº¦é«˜ |
| 5    | 120,000 | 220,000 | ç¬¬äº”ä¸–ä»£ï¼Œéæ¸¡æœŸé…å¸ƒ |
| 6    | 50,000  | 120,000 | 3DS æ™‚æœŸï¼Œé…å¸ƒæ•¸é‡é–‹å§‹å¢åŠ  |
| 7    | 10,000  | 50,000  | å¤ªé™½æœˆäº®æ™‚æœŸï¼Œé…å¸ƒè¼ƒç‚ºæ™®åŠ |
| 8    | 5,000   | 10,000  | åŠç›¾æ™‚æœŸï¼Œå¤§é‡ Wi-Fi é…å¸ƒ |
| 9    | 500     | 5,000   | æœ€æ–°ä¸–ä»£ï¼Œå–å¾—ç›¸å°å®¹æ˜“ |

> ğŸ’¡ è¨­è¨ˆåŸå‰‡ï¼š**è¶Šå¤è€ = è¶Šå€¼éŒ¢**ã€‚ç¬¬ 9 ä¸–ä»£çš„ä¸Šé™ï¼ˆ5,000ï¼‰ç­‰æ–¼ç¬¬ 8 ä¸–ä»£çš„ä¸‹é™ã€‚

---

## è³‡æ–™åº«å±¤è¨ˆç®—å…¬å¼

### æ ¸å¿ƒ SQL é‚è¼¯

é»æ•¸åœ¨ Supabase è³‡æ–™åº«ä¸­é€é SQL ä¸€æ¬¡æ€§è¨ˆç®—ä¸¦å„²å­˜è‡³ `distributions.points` æ¬„ä½ï¼š

```sql
points = CLAMP(
    range_min + (range_max - range_min) Ã— CLAMP(0.15 + èªç¨®åˆ†æ•¸ + é–ƒå…‰åˆ†æ•¸ + é…å¸ƒæ–¹å¼åˆ†æ•¸ + å¹´ä»£åˆ†æ•¸ + IDéš¨æ©Ÿåç§», 0, 1.0)
, range_min, range_max)
```

### å„é …å› å­èªªæ˜

#### 1ï¸âƒ£ èªç¨®åˆ†æ•¸ï¼ˆlang_scoreï¼‰

æ ¹æ“š `original_trainer` æ¬„ä½ä¸­çš„æ–‡å­—åˆ¤æ–·ï¼š

| æ¢ä»¶ | åˆ†æ•¸ | èªªæ˜ |
|------|:----:|------|
| ç´”éŸ“æ–‡ï¼ˆåƒ…éŸ“æ–‡å­—ç¬¦ï¼‰ | 0.30 | éŸ“ç‰ˆé…å¸ƒæœ€ç¨€æœ‰ |
| éŸ“æ–‡æ··åˆå…¶ä»–èªè¨€ | 0.22 | éŸ“æ–‡ç‚ºä¸»çš„å¤šèªé…å¸ƒ |
| ç´”æ—¥æ–‡ï¼ˆåƒ…å‡åï¼‰ | 0.18 | æ—¥æœ¬é™å®šé…å¸ƒ |
| æ—¥æ–‡æ··åˆè‹±æ–‡ | 0.14 | æ—¥æœ¬é…å¸ƒä½†æœ‰è‹±æ–‡å |
| ç´”è‹±æ–‡ | 0.06 | åœ‹éš›ç‰ˆé…å¸ƒï¼Œè¼ƒç‚ºæ™®é |
| å…¶ä»– / ç„¡æ³•åˆ¤æ–· | 0.10 | é è¨­å€¼ |

**åˆ¤æ–·é‚è¼¯**ï¼šä½¿ç”¨æ­£å‰‡è¡¨é”å¼åŒ¹é… Unicode å­—ç¬¦ç¯„åœ
- éŸ“æ–‡ï¼š`[ê°€-í£]`
- æ—¥æ–‡ç‰‡å‡åï¼š`[ã‚¡-ãƒ¶ãƒ¼]`
- æ—¥æ–‡å¹³å‡åï¼š`[ã-ã‚“]`
- è‹±æ–‡ï¼š`[A-Za-z]`

#### 2ï¸âƒ£ é–ƒå…‰åˆ†æ•¸ï¼ˆshiny_scoreï¼‰

| æ¢ä»¶ | åˆ†æ•¸ |
|------|:----:|
| `is_shiny = true` | 0.15 |
| `is_shiny = false` æˆ– NULL | 0.00 |

#### 3ï¸âƒ£ é…å¸ƒæ–¹å¼åˆ†æ•¸ï¼ˆmethod_scoreï¼‰

| é…å¸ƒæ–¹å¼ | åˆ†æ•¸ | èªªæ˜ |
|---------|:----:|------|
| ç¾å ´æ´»å‹• / æ´»å‹• | 0.12 | æœ€ç¨€æœ‰ï¼Œéœ€è¦ªè‡¨ç¾å ´ |
| ç´…å¤–ç·š | 0.10 | DS æ™‚ä»£çš„è¿‘è·é›¢é…å¸ƒ |
| åºè™Ÿ / åºåˆ— | 0.08 | éœ€å–å¾—å…Œæ›ç¢¼ |
| HOME | 0.05 | PokÃ©mon HOME ç·šä¸Šé…å¸ƒ |
| å…¶ä»–ï¼ˆWi-Fiã€å¯†èªç­‰ï¼‰ | 0.03 | æœ€å®¹æ˜“å–å¾— |

**åˆ¤æ–·é‚è¼¯**ï¼šä½¿ç”¨ `ILIKE '%é—œéµå­—%'` å° `distribution_method` æ¬„ä½é€²è¡Œæ¨¡ç³ŠåŒ¹é…ã€‚

#### 4ï¸âƒ£ å¹´ä»£åˆ†æ•¸ï¼ˆage_scoreï¼‰

```sql
CASE 
  WHEN distribution_period_start IS NOT NULL THEN
    LEAST(0.15, 0.15 Ã— (ä»Šå¤© - é…å¸ƒé–‹å§‹æ—¥) / 20å¹´)
  ELSE 
    0.08  -- ç„¡æ—¥æœŸè³‡æ–™çš„é è¨­å€¼
END
```

- **æœ€å¤§å€¼**ï¼š0.15ï¼ˆé…å¸ƒæ—¥æœŸè·ä»Š 20 å¹´ä»¥ä¸Šï¼‰
- **ç·šæ€§æ¯”ä¾‹**ï¼šè¶Šè€è¶Šé«˜åˆ†
- **ç„¡æ—¥æœŸ**ï¼šçµ¦ 0.08 çš„ä¿å®ˆåˆ†æ•¸

#### 5ï¸âƒ£ ID éš¨æ©Ÿåç§»ï¼ˆid_random_offsetï¼‰

```sql
(UUIDå‰8ä½hexè½‰æ•¸å­— % 10000) / 40000.0
```

- **ç¯„åœ**ï¼š0.0000 ~ 0.2500
- **ç›®çš„**ï¼šç¢ºä¿å³ä½¿æ‰€æœ‰å› å­ç›¸åŒï¼Œæ¯ç­†è¨˜éŒ„ä»æœ‰ç¨ç‰¹çš„é»æ•¸
- **æ–¹æ³•**ï¼šå– UUID çš„å‰ 8 ä½åå…­é€²ä½å­—ç¬¦ï¼Œè½‰æˆæ•´æ•¸å¾Œå–æ¨¡

### è¨ˆç®—ç¯„ä¾‹

ä»¥ä¸€ç­†ç¬¬ 6 ä¸–ä»£éŸ“æ–‡é–ƒå…‰ç¾å ´æ´»å‹•é…å¸ƒï¼ˆè·ä»Š 8 å¹´ï¼‰ç‚ºä¾‹ï¼š

```
range_min = 50,000
range_max = 120,000
base = 0.15

èªç¨® = 0.30 (ç´”éŸ“æ–‡)
é–ƒå…‰ = 0.15
æ–¹å¼ = 0.12 (ç¾å ´æ´»å‹•)
å¹´ä»£ = 0.15 Ã— (8/20) = 0.06
éš¨æ©Ÿåç§» = 0.12 (å‡è¨­)

ç¸½åˆ† = 0.15 + 0.30 + 0.15 + 0.12 + 0.06 + 0.12 = 0.90

points = 50,000 + (120,000 - 50,000) Ã— 0.90
       = 50,000 + 63,000
       = 113,000
```

### ç‰¹æ®Šè¦†å¯«

æŸäº›å¯¶å¯å¤¢çš„é»æ•¸æœƒåœ¨é€šç”¨å…¬å¼ä¹‹å¾Œè¢«**æ‰‹å‹•è¦†å¯«**ï¼š

| å¯¶å¯å¤¢ | ç›®æ¨™é»æ•¸ | æ›´æ–° SQL |
|--------|---------|---------|
| åŒ–çŸ³ç³»ï¼ˆå†°é›ªé¾ã€å¯¶å¯¶æš´é¾ã€é°“é­šé¾ï¼‰ | 900,000+ | `points = 900000 + hash(id) % 90000` |
| å …ç›¾åŠæ€ªï¼ˆç¬¬ 7 ä¸–ä»£ï¼‰ | 800,000+ | ç›®å‰ä¸åœ¨è³‡æ–™åº«ä¸­ï¼Œå¾…æ–°å¢ |

---

## å‰ç«¯é¡¯ç¤ºé‚è¼¯

### è³‡æ–™æµ

```
Supabase DB (points INTEGER)
    â†“ select("*")
app/pokedex/page.tsx (Server Component)
    â†“ props
components/PokedexContent.tsx (Client Component)
    â†“ formatPoints() + getFluctuation()
å¡ç‰‡ UI æ¸²æŸ“
```

### é»æ•¸é¡¯ç¤ºæµç¨‹

```tsx
{dist.points ? (() => {
    // 1. æª¢æŸ¥ä¼Šå¸ƒé®ç½©
    if (isEeveeFamily(dist.pokemon_name)) {
        return <é®ç½© UI />;
    }
    
    // 2. è¨ˆç®—æ¼²è·Œå¹…
    const fluct = getFluctuation(dist.id, dist.points);
    
    // 3. æ¸²æŸ“é»æ•¸ + æ¼²è·Œ
    return (
        <div>
            <p>ğŸ’ {formatPoints(dist.points)}</p>
            <p>{fluct.isPositive ? '+' : '-'}{fluct.value}</p>
        </div>
    );
})() : <é¡¯ç¤ºç ´æŠ˜è™Ÿ />}
```

---

## æ¼²è·Œå¹…æ¼”ç®—æ³•

### å‡½å¼ç°½å

```typescript
function getFluctuation(id: string, points: number): { value: number; isPositive: boolean }
```

### æ¼”ç®—æ³•æ­¥é©Ÿ

```
1. ç¨®å­ = UUID + ä»Šå¤©æ—¥æœŸ (YYYY-MM-DD)
2. hash = å°ç¨®å­å­—ä¸²åš DJB2-like å“ˆå¸Œ
3. æ–¹å‘ = |hash| % 100 < 55 ? ä¸Šæ¼² : ä¸‹è·Œ     // 55% æ©Ÿç‡ä¸Šæ¼²
4. å¹…åº¦ = ((|hash >> 8| % 750) + 50) / 10000   // 0.50% ~ 8.00%
5. æ¼²è·Œå€¼ = points Ã— å¹…åº¦
6. å››æ¨äº”å…¥åˆ°å…©ä½å°æ•¸
```

### é—œéµè¨­è¨ˆ

| ç‰¹æ€§ | èªªæ˜ |
|------|------|
| **æ¯æ—¥è®ŠåŒ–** | ç¨®å­åŒ…å«æ—¥æœŸï¼ŒåŒä¸€å¤©çœ‹åˆ°ç›¸åŒçµæœï¼Œéš”å¤©è‡ªå‹•ä¸åŒ |
| **ç©©å®šä¸€è‡´** | åŒä¸€å¤©å…§ï¼ŒåŒä¸€å¼µå¡ä¸è«–é‡æ–°æ•´ç†å¤šå°‘æ¬¡ï¼Œæ¼²è·Œéƒ½ä¸€æ¨£ |
| **å¸¶å°æ•¸** | æ¼²è·Œå€¼ä¿ç•™å…©ä½å°æ•¸ï¼ˆå¦‚ `+178.25`ã€`-75.42`ï¼‰ |
| **55% åˆ©å¤š** | ç•¥åå‘ä¸Šæ¼²ï¼Œç‡Ÿé€ æ­£é¢æ„Ÿå— |
| **æ¯”ä¾‹åˆç†** | é«˜é»æ•¸çš„å¡æ¼²è·Œå¹…ä¹Ÿå¤§ï¼ˆçµ•å°å€¼ï¼‰ï¼Œä½é»æ•¸çš„å¡æ¼²è·Œå¹…å° |

### å“ˆå¸Œå‡½å¼

```typescript
let hash = 0;
for (let i = 0; i < seed.length; i++) {
    hash = ((hash << 5) - hash + seed.charCodeAt(i)) | 0;
}
```

é€™æ˜¯ DJB2 å“ˆå¸Œçš„è®Šé«”ï¼Œ`| 0` ç¢ºä¿çµæœç‚º 32-bit æ•´æ•¸ã€‚ä½ç§» `hash >> 8` ç”¨æ–¼å–å¾—ä¸åŒçš„ä½å…ƒæ®µä¾†æ±ºå®šå¹…åº¦ï¼ˆé¿å…æ–¹å‘å’Œå¹…åº¦ä½¿ç”¨åŒä¸€çµ„ä½å…ƒï¼‰ã€‚

---

## é»æ•¸æ ¼å¼åŒ–

### å‡½å¼

```typescript
function formatPoints(points: number): string {
    const decimal = (points % 100) / 100;
    const display = points + decimal;
    return display.toLocaleString(undefined, { 
        minimumFractionDigits: 2, 
        maximumFractionDigits: 2 
    });
}
```

### è¦å‰‡

- **å°æ•¸é»ä¾†æº**ï¼šå–æ•´æ•¸çš„æœ«å…©ä½ä½œç‚ºå°æ•¸ï¼ˆæ¨¡æ“¬ç²¾ç¢ºæ„Ÿï¼‰
- **ç¯„ä¾‹**ï¼š
  - `921551` â†’ `921,551.51`
  - `3054` â†’ `3,054.54`
  - `507000` â†’ `507,000.00`
- **åƒåˆ†ä½**ï¼šä½¿ç”¨ `toLocaleString` è‡ªå‹•åŠ é€—è™Ÿ

---

## è¦–è¦ºè‰²éšç³»çµ±

### é»æ•¸ â†’ é¡è‰²å°ç…§è¡¨

| é»æ•¸ç¯„åœ | è‰²éš | CSS é¡å | è¦–è¦ºæ•ˆæœ |
|---------|------|---------|---------|
| â‰¥ 900,000 | ğŸ”´ ç´…æ©™ | `from-red-500/30 to-orange-500/30 text-red-300` | åŒ–çŸ³ç´šçå“ |
| â‰¥ 350,000 | ğŸŸ¡ é‡‘é»ƒ | `from-amber-500/30 to-yellow-500/30 text-amber-300` | ç¬¬ 3 ä¸–ä»£ç´š |
| â‰¥ 120,000 | ğŸŸ£ ç´«ç²‰ | `from-purple-500/30 to-pink-500/30 text-purple-300` | ç¬¬ 4~5 ä¸–ä»£ç´š |
| â‰¥ 50,000  | ğŸ”µ è—é’ | `from-blue-500/30 to-cyan-500/30 text-blue-300` | ç¬¬ 6 ä¸–ä»£ç´š |
| â‰¥ 10,000  | ğŸŸ¢ ç¿ ç¶  | `from-emerald-500/30 to-green-500/30 text-emerald-300` | ç¬¬ 7 ä¸–ä»£ç´š |
| â‰¥ 5,000   | ğŸ©µ é’ç¢§ | `from-teal-500/30 to-cyan-500/30 text-teal-300` | ç¬¬ 8 ä¸–ä»£ç´š |
| < 5,000   | âšª ç°ç™½ | `bg-white/10 text-white/50` | ç¬¬ 9 ä¸–ä»£ç´š |

### æ¼²è·Œé¡è‰²

| ç‹€æ…‹ | é¡è‰² | CSS |
|------|------|-----|
| ä¸Šæ¼² (+) | ç¶ è‰² | `text-green-400` |
| ä¸‹è·Œ (-) | ç´…è‰² | `text-red-400` |

---

## ç‰¹æ®Šè¦å‰‡

### ğŸ¦Š ä¼Šå¸ƒå®¶æ—é®ç½©

**è§¸ç™¼æ¢ä»¶**ï¼š`pokemon_name` åŒ…å« `'ä¼Šå¸ƒ'`

**æ¶µè“‹å°è±¡**ï¼š
- ä¼Šå¸ƒï¼ˆEeveeï¼‰
- æ°´ä¼Šå¸ƒï¼ˆVaporeonï¼‰
- é›·ä¼Šå¸ƒï¼ˆJolteonï¼‰
- ç«ä¼Šå¸ƒï¼ˆFlareonï¼‰
- å¤ªé™½ä¼Šå¸ƒï¼ˆEspeonï¼‰
- æœˆäº®ä¼Šå¸ƒï¼ˆUmbreonï¼‰
- è‘‰ä¼Šå¸ƒï¼ˆLeafeonï¼‰
- å†°ä¼Šå¸ƒï¼ˆGlaceonï¼‰
- ä»™å­ä¼Šå¸ƒï¼ˆSylveonï¼‰

**é¡¯ç¤ºæ•ˆæœ**ï¼šä¸é¡¯ç¤ºé»æ•¸å’Œæ¼²è·Œï¼Œæ”¹ç‚ºç´…è‰²é®ç½©ï¼š
```
âš ï¸ åƒ¹æ ¼æ³¢å‹•å·¨å¤§
ï¼ˆæš«ä¸é¡¯ç¤ºï¼‰
```

**æŠ€è¡“å¯¦ä½œ**ï¼š
```tsx
function isEeveeFamily(name: string): boolean {
    return name.includes('ä¼Šå¸ƒ');
}
```

### ğŸ¦´ åŒ–çŸ³ç³»å¯¶å¯å¤¢åŠ åˆ†

ä»¥ä¸‹åŒ–çŸ³ç³»å¯¶å¯å¤¢çš„é»æ•¸è¢«æ‰‹å‹•è¨­å®šç‚º **900,000+**ï¼š

| å¯¶å¯å¤¢ | ä¸–ä»£ | ç¾æœ‰é»æ•¸ |
|--------|:----:|--------:|
| é°“é­šé¾ | 8 | 968,773 |
| é°“é­šé¾ | 8 | 921,551 |
| å¯¶å¯¶æš´é¾ | 6 | 925,870 |
| å†°é›ªé¾ | 6 | 920,754 |

> åŒ–çŸ³ç³»å¯¶å¯å¤¢è¢«è¦–ç‚ºç‰¹æ®Šè³‡ç”¢ï¼Œç„¡è«–å…¶ä¸–ä»£åŸå§‹ç¯„åœï¼Œä¸€å¾‹æå‡è‡³ 90 è¬ä»¥ä¸Šã€‚

---

## å…è²¬è²æ˜å½ˆçª—

### è§¸ç™¼æ™‚æ©Ÿ

æ¯æ¬¡ç”¨æˆ¶é€²å…¥é…å¸ƒåœ–é‘‘é é¢æ™‚è‡ªå‹•é¡¯ç¤ºã€‚ä½¿ç”¨ `useState(true)` æ§åˆ¶ï¼Œä¸åš localStorage æŒä¹…åŒ–ï¼ˆå³æ¯æ¬¡é€ è¨ªéƒ½æœƒå‡ºç¾ï¼‰ã€‚

### å½ˆçª—å…§å®¹

```
ğŸ“‹ é…å¸ƒåœ–é‘‘ â€” è³‡æ–™èªªæ˜

âš ï¸ è³‡æ–™ç¯„åœèªªæ˜
Â· ä¸¦éæ‰€æœ‰å¯¶å¯å¤¢é…å¸ƒéƒ½åˆ—åœ¨å…¶ä¸­
Â· ä»¥ã€Œå³æ™‚äº¤æ˜“ã€è€Œå‡ºç¾åœ¨ç³»çµ±ä¸­çš„ç‚ºä¸»
Â· åƒ…æä¾›ã€Œäº”å¤©å…§æœ‰éè‡³å°‘åç­†äº¤æ˜“ã€ä»¥ä¸Šçš„å¯¶å¯å¤¢é…å¸ƒè³‡æ–™
Â· å¦‚æ¬²æŸ¥è©¢äº”å¤©ä¹‹å¤–çš„é…å¸ƒä¹‹å€‹åˆ¥é»æ•¸ï¼Œè«‹æ´½ç®¡ç†å“¡

â„¹ï¸ å…è²¬è²æ˜
è³‡è¨Šæ•´ç†ç‚ºç³»çµ±è‡ªå‹•æ•´ç†ï¼Œé›£å…æœ‰èª¤ï¼Œæ•¬è«‹è¦‹è«’ã€‚
ç›¸é—œå•é¡Œæ­¡è¿è‡´é›»ç®¡ç†å“¡ã€‚

[ æˆ‘çŸ¥é“äº† ]
```

### UI è¦æ ¼

- **èƒŒæ™¯**ï¼šå…¨è¢å¹•é®ç½© + `backdrop-filter: blur(8px)` æ¯›ç»ç’ƒæ•ˆæœ
- **Z-Index**ï¼š`z-[9999]`ï¼ˆç¢ºä¿åœ¨æ‰€æœ‰å…ƒç´ ä¹‹ä¸Šï¼‰
- **å¡ç‰‡**ï¼šåœ“è§’ 2xl + æ¼¸å±¤èƒŒæ™¯ (slate-800 â†’ slate-900)
- **æŒ‰éˆ•**ï¼šç¥ç€è‰²åˆ°æ©™è‰²æ¼¸å±¤ï¼Œå¸¶é™°å½±å’Œé»æ“Šç¸®æ”¾

---

## è³‡æ–™çµ±è¨ˆ

æœ€è¿‘ä¸€æ¬¡è¨ˆç®—çš„å„ä¸–ä»£é»æ•¸åˆ†ä½ˆï¼ˆ2026-02-13ï¼‰ï¼š

| ä¸–ä»£ | ç¸½ç­†æ•¸ | ä¸é‡è¤‡é»æ•¸ | æœ€ä½ | æœ€é«˜ | å¹³å‡ |
|:----:|:------:|:---------:|-----:|-----:|-----:|
| 3 | 9 | 9 (100%) | 920,366 | 1,047,925 | 1,001,912 |
| 4 | 15 | 15 (100%) | 252,949 | 310,776 | 280,707 |
| 5 | 14 | 14 (100%) | 141,288 | 187,230 | 161,056 |
| 6 | 133 | 133 (100%) | 55,600 | 107,496 | 80,405 |
| 7 | 143 | 143 (100%) | 11,760 | 45,963 | 27,680 |
| 8 | 90 | 90 (100%) | 5,329 | 8,884 | 7,036 |
| 9 | 82 | 81 (99%) | 620 | 3,745 | 2,134 |

> Gen 3 å¹³å‡çªç ´ç™¾è¬ï¼ˆğŸ”´ ç´…æ©™è‰²éšï¼‰ï¼Œç‚ºæœ€é ‚ç´šè³‡ç”¢ã€‚å„ä¸–ä»£ä¸é‡è¤‡ç‡æ¥è¿‘ 100%ã€‚

---

## é™„éŒ„ï¼šå®Œæ•´ SQL è¨ˆç®—è…³æœ¬

```sql
WITH calc AS (
  SELECT id,
    generation,
    -- ä¸–ä»£ç¯„åœ
    CASE generation
      WHEN 9 THEN 500 WHEN 8 THEN 5000 WHEN 7 THEN 10000
      WHEN 6 THEN 50000 WHEN 5 THEN 120000 WHEN 4 THEN 220000 WHEN 3 THEN 650000
      ELSE 500
    END as range_min,
    CASE generation
      WHEN 9 THEN 5000 WHEN 8 THEN 10000 WHEN 7 THEN 50000
      WHEN 6 THEN 120000 WHEN 5 THEN 220000 WHEN 4 THEN 350000 WHEN 3 THEN 1200000
      ELSE 5000
    END as range_max,
    -- èªç¨®åˆ†æ•¸
    CASE 
      WHEN original_trainer ~ '[ê°€-í£]' AND original_trainer !~ '[ã‚¡-ãƒ´ã-ã‚“]' 
           AND original_trainer !~ '[A-Za-z]' THEN 0.30
      WHEN original_trainer ~ '[ê°€-í£]' THEN 0.22
      WHEN original_trainer ~ '[ã‚¡-ãƒ¶ãƒ¼]' AND original_trainer !~ '[A-Za-z]' THEN 0.18
      WHEN original_trainer ~ '[ã‚¡-ãƒ¶ãƒ¼]' THEN 0.14
      WHEN original_trainer ~ '[A-Za-z]' THEN 0.06
      ELSE 0.10
    END as lang_score,
    -- é–ƒå…‰åŠ åˆ†
    CASE WHEN is_shiny = true THEN 0.15 ELSE 0.0 END as shiny_score,
    -- é…å¸ƒæ–¹å¼åŠ åˆ†
    CASE 
      WHEN distribution_method ILIKE '%ç¾å ´%' OR distribution_method ILIKE '%æ´»å‹•%' THEN 0.12
      WHEN distribution_method ILIKE '%åºè™Ÿ%' OR distribution_method ILIKE '%åºåˆ—%' THEN 0.08
      WHEN distribution_method ILIKE '%ç´…å¤–ç·š%' THEN 0.10
      WHEN distribution_method ILIKE '%HOME%' THEN 0.05
      ELSE 0.03
    END as method_score,
    -- å¹´ä»£åŠ åˆ†
    CASE 
      WHEN distribution_period_start IS NOT NULL THEN
        LEAST(0.15, 0.15 * EXTRACT(EPOCH FROM (NOW() - distribution_period_start::timestamp)) 
              / (EXTRACT(EPOCH FROM INTERVAL '20 years')))
      ELSE 0.08
    END as age_score,
    -- ID éš¨æ©Ÿåç§»
    (('x' || LPAD(REPLACE(SPLIT_PART(id::text, '-', 1), '-', ''), 8, '0'))::bit(32)::int::numeric 
     % 10000) / 40000.0 as id_random_offset
  FROM distributions
)
UPDATE distributions d
SET points = LEAST(
  c.range_max,
  GREATEST(
    c.range_min,
    (c.range_min + (c.range_max - c.range_min) 
     * LEAST(1.0, 0.15 + c.lang_score + c.shiny_score + c.method_score + c.age_score + c.id_random_offset))
  )
)::INTEGER
FROM calc c
WHERE d.id = c.id;

-- åŒ–çŸ³ç³»ç‰¹æ®Šè¦†å¯«
UPDATE distributions
SET points = 900000 + (ABS(('x' || LPAD(REPLACE(SPLIT_PART(id::text, '-', 1), '-', ''), 8, '0'))
              ::bit(32)::int) % 90000)
WHERE pokemon_name IN ('å†°é›ªé¾', 'å¯¶å¯¶æš´é¾', 'é°“é­šé¾');
```

---

## è®Šæ›´ç´€éŒ„

| æ—¥æœŸ | è®Šæ›´å…§å®¹ |
|------|---------|
| 2026-02-13 | åˆç‰ˆå»ºç«‹ï¼šä¸–ä»£é»æ•¸ç¯„åœã€å¤šå› å­è¨ˆç®—ã€UUID åç§»å»é‡ |
| 2026-02-13 | æ¼²è·Œå¹…åŠ å…¥å°æ•¸é»ï¼ˆå…©ä½ï¼‰ |
| 2026-02-13 | æ–°å¢ä¼Šå¸ƒå®¶æ—é®ç½©ï¼ˆåƒ¹æ ¼æ³¢å‹•å·¨å¤§ï¼‰ |
| 2026-02-13 | åŒ–çŸ³ç³»å¯¶å¯å¤¢é»æ•¸è¦†å¯«è‡³ 90 è¬+ |
| 2026-02-13 | æ–°å¢ 900,000+ ç´…æ©™è‰²éš |
| 2026-02-13 | æ–°å¢å…è²¬è²æ˜å½ˆçª— |
| 2026-02-14 | Gen 3 é»æ•¸ç¯„åœå¾ 350k~700k æå‡è‡³ 650k~1,200kï¼ˆå¹³å‡çªç ´ç™¾è¬ï¼‰ |
