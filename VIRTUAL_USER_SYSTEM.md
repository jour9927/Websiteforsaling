# ğŸ¤– æ°´è»æ¨¡æ“¬ç”¨æˆ¶ç³»çµ±

## æ¦‚è¿°

æ­¤ç³»çµ±ç”¨æ–¼æ¨¡æ“¬è™›æ“¬ç”¨æˆ¶åœ¨å¹³å°ä¸Šçš„äº’å‹•è¡Œç‚ºï¼Œå¢åŠ ç”¨æˆ¶é é¢çš„æ´»èºåº¦ã€‚

---

## åŠŸèƒ½åˆ—è¡¨

| åŠŸèƒ½ | èªªæ˜ | åŸ·è¡Œæ™‚é–“ |
|------|------|---------|
| **è™›æ“¬è¨ªå•** | è™›æ“¬ç”¨æˆ¶è¨ªå•çœŸå¯¦ç”¨æˆ¶é é¢ | æ¯å¤© 11:00 |
| **è™›æ“¬ç•™è¨€** | 30% æ©Ÿç‡è‡ªå‹•ç•™è¨€ | æ¯å¤© 11:00 |
| **æ‰‹å‹•ç•™è¨€** | ç®¡ç†å“¡è‡ªè¨‚ç•™è¨€å…§å®¹ | éš¨æ™‚ |
| **ç€è¦½é‡ç´¯åŠ ** | æ›´æ–° total_views å’Œ today_views | æ¯å¤© 11:00 |
| **è‡ªå‹•æ¸…ç†** | åˆªé™¤ 7 å¤©ä»¥ä¸Šçš„è™›æ“¬ç•™è¨€å’Œè¨ªå• | æ¯å¤© 11:00 |

---

## ç•™è¨€ä¿ç•™ç­–ç•¥

| é¡¯ç¤º | å„²å­˜ |
|------|------|
| ä¸»é åªé¡¯ç¤º **æœ€è¿‘ 3 å¤©** çš„ç•™è¨€ | è™›æ“¬ç•™è¨€/è¨ªå•åœ¨æœå‹™å™¨ä¿ç•™ **7 å¤©** |

> æ¯å¤© Cron Job æœƒè‡ªå‹•æ¸…ç†è¶…é 7 å¤©çš„è™›æ“¬è¨˜éŒ„

---

## è¨è«–ä¸²å›è¦†åŠŸèƒ½

| åŠŸèƒ½ | èªªæ˜ |
|------|------|
| **å›è¦†ç•™è¨€** | é»æ“Šã€Œâ†³ å›è¦†ã€æŒ‰éˆ•å›è¦†ç•™è¨€ |
| **è¨è«–ä¸²é¡¯ç¤º** | å›è¦†æœƒç¸®æ’é¡¯ç¤ºåœ¨åŸç•™è¨€ä¸‹æ–¹ |
| **æ°¸ä¹…ä¿å­˜** | æœ‰çœŸå¯¦ç”¨æˆ¶å›è¦†çš„è¨è«–ä¸²æ°¸ä¸åˆªé™¤ |

> è³‡æ–™åº«è§¸ç™¼å™¨æœƒè‡ªå‹•å°‡ `has_real_reply` è¨­ç‚º `true`

```
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/cron/virtual-visits/route.ts   # Cron Job API
â”‚   â”œâ”€â”€ admin/virtual-comments/page.tsx    # ç®¡ç†å¾Œå°é é¢
â”‚   â””â”€â”€ user/[id]/page.tsx                 # è™›æ“¬ç”¨æˆ¶å€‹äººé é¢
â”œâ”€â”€ components/
â”‚   â””â”€â”€ PersonalSpaceContent.tsx           # é¡¯ç¤ºè™›æ“¬è¨ªå®¢å’Œç•™è¨€
â”œâ”€â”€ supabase/migrations/
â”‚   â”œâ”€â”€ 021_create_virtual_profiles.sql    # è™›æ“¬ç”¨æˆ¶è¡¨
â”‚   â”œâ”€â”€ 026_virtual_visits.sql             # è™›æ“¬è¨ªå•æ”¯æ´
â”‚   â”œâ”€â”€ 027_increment_views_function.sql   # ç€è¦½é‡å‡½æ•¸
â”‚   â””â”€â”€ 028_virtual_comments.sql           # è™›æ“¬ç•™è¨€æ”¯æ´
â””â”€â”€ vercel.json                            # Cron æ’ç¨‹è¨­å®š
```

---

## è³‡æ–™åº«è¡¨æ ¼

### virtual_profilesï¼ˆè™›æ“¬ç”¨æˆ¶ï¼‰
- `id` - UUID ä¸»éµ
- `display_name` - é¡¯ç¤ºåç¨±ï¼ˆå¦‚ã€Œç‹**ã€ã€Œæ**ã€ï¼‰
- `avatar_url` - é ­åƒ URL
- `bio` - ç°¡ä»‹

### profile_visitsï¼ˆè¨ªå•è¨˜éŒ„ï¼‰
- `profile_user_id` - è¢«è¨ªå•çš„ç”¨æˆ¶
- `visitor_id` - çœŸå¯¦è¨ªå®¢ IDï¼ˆå¯ç‚º NULLï¼‰
- `virtual_visitor_id` - è™›æ“¬è¨ªå®¢ ID
- `is_virtual` - æ˜¯å¦ç‚ºè™›æ“¬è¨ªå•
- `visited_at` - è¨ªå•æ™‚é–“

### profile_commentsï¼ˆç•™è¨€ï¼‰
- `profile_user_id` - è¢«ç•™è¨€çš„ç”¨æˆ¶
- `commenter_id` - çœŸå¯¦ç•™è¨€è€… IDï¼ˆå¯ç‚º NULLï¼‰
- `virtual_commenter_id` - è™›æ“¬ç•™è¨€è€… ID
- `is_virtual` - æ˜¯å¦ç‚ºè™›æ“¬ç•™è¨€
- `content` - ç•™è¨€å…§å®¹

---

## ä½¿ç”¨æ–¹å¼

### è‡ªå‹•åŸ·è¡Œï¼ˆCron Jobï¼‰
- **æ™‚é–“**ï¼šæ¯å¤© 11:00ï¼ˆUTC+8ï¼‰
- **API**ï¼š`/api/cron/virtual-visits`
- **è¨­å®š**ï¼š`vercel.json`

### æ‰‹å‹•ç®¡ç†
1. é€²å…¥ `/admin/virtual-comments`
2. é¸æ“‡ç›®æ¨™ç”¨æˆ¶
3. é¸æ“‡è™›æ“¬ç”¨æˆ¶
4. è¼¸å…¥ç•™è¨€å…§å®¹æˆ–ä½¿ç”¨å¿«é€Ÿç¯„æœ¬
5. ç™¼é€

---

## é è¨­ç•™è¨€ç¯„æœ¬

```
æ”¶è—å¥½æ¼‚äº®ï¼ğŸŒŸ
å¤§ä½¬å¸¶å¸¶æˆ‘ ğŸ™
ä»€éº¼æ™‚å€™å†ä¸Šæ–°çš„ï¼Ÿ
å¥½ç¾¨æ…•ä½ çš„æ”¶è—
é€™å€‹é…å¸ƒæˆ‘ä¹Ÿæœ‰ï¼
å¯ä»¥äº¤æµä¸€ä¸‹å—ï¼Ÿ
æ–°æ‰‹å ±åˆ°ï¼å­¸ç¿’ä¸­ ğŸ“š
ä½ çš„é¡˜æœ›æ¸…å–®æˆ‘éƒ½æƒ³è¦ ğŸ˜‚
æ”¶è—å®¶ respect ğŸ«¡
è·¯éç•™è¨€ï½
å¤ªå¼·äº†å§é€™æ”¶è—ï¼
æœŸå¾…ä½ çš„æ–°å¢æ”¶è— ğŸ‘€
```

---

## ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸åç¨± | èªªæ˜ |
|---------|------|
| `CRON_SECRET` | Cron Job å®‰å…¨é©—è­‰é‡‘é‘° |
| `SUPABASE_SERVICE_ROLE_KEY` | Supabase æœå‹™è§’è‰²é‡‘é‘°ï¼ˆç”¨æ–¼ç¹é RLSï¼‰ |

---

## æ›´æ–°æ—¥èªŒ

- **2026-02-08** - å»ºç«‹æ°´è»ç•™è¨€ç®¡ç†å¾Œå°
- **2026-02-08** - æ–°å¢è™›æ“¬ç•™è¨€åˆ° Cron Job
- **2026-02-08** - æ•´åˆè™›æ“¬ç”¨æˆ¶ç³»çµ±ï¼Œä½¿ç”¨ virtual_profiles ä½œç‚ºè¨ªå®¢ä¾†æº
